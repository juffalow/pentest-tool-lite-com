import React, { useState, useEffect } from 'react';
import Container from 'react-bootstrap/Container';
import Row from 'react-bootstrap/Row';
import Col from 'react-bootstrap/Col';
import Result from './report/Result';
import SEO from '../components/SEO';
import { getResult } from '../api/services';

const Report: React.FC = ({ match }: any) => {
  const [ test, setTest ] = useState<any>(null);

  useEffect(() => {
    getResult(match.params.id).then((response: any) => setTest(response));
    //getResult(match.params.id).then((response: any) => console.log(response));
  }, []);

  return (
    <SEO title="Report" description="">
      <Container>
        <Row>
          <Col>
            <h1>Report</h1>
            {
              test !== null ? (
                <>
                  <p><b>URL</b>: <a href={test.url} target="_blank" rel="noopener noreferrer">{test.url}</a></p>
                  <p><b>Requested at</b>: {test.createdAt}</p>
                  <p><b>Status</b>: {test.status}</p>
                </>
              ) : null
            }
            
          </Col>
        </Row>
        <Row className="mt-4">
          <Col>
            <h2>Security</h2>
            {
              test !== null && test.status === 'done' ? (
                <Result tests={test.result.security.results} level={1} />
              ) : null
            }
          </Col>
        </Row>
        <Row className="mt-4">
          <Col>
            <h2>HTML</h2>
            {
              test !== null && test.status === 'done' ? (
                <Result tests={test.result.html.results} level={1} />
              ) : null
            }
          </Col>
        </Row>
      </Container>
    </SEO>
  );
}

export default Report;
