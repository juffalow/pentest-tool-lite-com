import React, { useState, useEffect } from 'react';
import Spinner from 'react-bootstrap/Spinner';

interface ImageLoaderProps {
  src: string;
  alt?: string;
  alternativeImage?: string;
  as?: React.ElementType;
  [x:string]: any;
}

const ImageLoader: React.FC<ImageLoaderProps> = ({ src, alt, alternativeImage, ...rest }: ImageLoaderProps) => {
  const [ isLoading, setIsLoading ] = useState(true);

  useEffect(() => {
    const image = new Image();

    image.onload = () => {
      setIsLoading(false);
    };

    image.onerror = () => {
      if (typeof alternativeImage !== 'undefined') {
        image.src = alternativeImage;
      }
    };

    image.src = src;

    return () => {
      image.src = "";
    }
  }, []);

  if (isLoading) {
    return (
      <div style={{ width: '100%', height: '100%' }}>
        <div style={{ position: 'absolute', left: '50%', top: '50%', transform: 'translate(-50%, -50%)' }}>
          <Spinner animation="border" />
        </div>
      </div>
    );
  }

  const Component = ('as' in rest ? rest.as : 'img') as React.FunctionComponent<any>;

  return (
    <Component src={src} alt={alt} {...rest} />
  );
}

export default ImageLoader;
