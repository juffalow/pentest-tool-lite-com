import express from 'express';
import logger from '../logger';
import { getDNS } from '../utils/functions';

const router = express.Router();

router.get('/', async (req, res) => {
  const query = req.query;

  if (!('domain' in query) || typeof query.domain !== 'string' || query.domain.length === 0) {
    return res.json({
      error: {
        message: 'Parameter domain is mandatory!',
      },
    });
  }

  const domain = query.domain;
  let dns = null;

  try {
    dns = await getDNS(domain as string);
  } catch (error) {
    return res.json({
      error: {
        message: error.message,
      },
    });
  }

  res.json({
    data: {
      dns,
    },
  });
});

export default router;
