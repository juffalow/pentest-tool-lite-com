import { LRUCache } from 'lru-cache';
import DynamoDBRepository from './DynamoDBRepository';
import CacheRepository from './CacheRepository';
import services from '../../services';

const cache = new LRUCache<string, any>({ max: 1 });

const container = {
  get dynamoDBRepository(): RecentTestsRepository {
    if (typeof this._dynamoDBRepository === 'undefined') {
      this._dynamoDBRepository = new DynamoDBRepository(services.Database);
    }

    return this._dynamoDBRepository;
  },

  get cacheRepository(): RecentTestsRepository {
    if (typeof this._cacheRepository === 'undefined') {
      this._cacheRepository = new CacheRepository(this.dynamoDBRepository, cache);
    }

    return this._cacheRepository
  },
};

export default container;
